<!DOCTYPE html>
<html>
<head>
  <title>Token Event Logs</title>
</head>
<body>
  <h1>Token Event Logs</h1>
  <div id="logs"></div>

  <script>
    // Replace with your Etherscan API key, token contract address, and contract ABI
    const etherscanApiKey = "AFFD2SXUNV3RY968V4442KMBP4928IBMJ7";
    const tokenContractAddress = "0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f"; // Replace with your token contract address
    const contractABI = [{"inputs":[{"internalType":"address","name":"_feeToSetter","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"token0","type":"address"},{"indexed":true,"internalType":"address","name":"token1","type":"address"},{"indexed":false,"internalType":"address","name":"pair","type":"address"},{"indexed":false,"internalType":"uint256","name":"","type":"uint256"}],"name":"PairCreated","type":"event"},{"constant":true,"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"allPairs","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"allPairsLength","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"tokenA","type":"address"},{"internalType":"address","name":"tokenB","type":"address"}],"name":"createPair","outputs":[{"internalType":"address","name":"pair","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"feeTo","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"feeToSetter","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"}],"name":"getPair","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"_feeTo","type":"address"}],"name":"setFeeTo","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"_feeToSetter","type":"address"}],"name":"setFeeToSetter","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"}];

    async function fetchTokenEventLogs() {
      // Calculate the block range to fetch the latest 1000 events
      const latestBlock = await getLatestBlockNumber();
      const fromBlock = latestBlock > 1000 ? latestBlock - 1000 : 0;

      const apiUrl = `https://api.etherscan.io/api?module=logs&action=getLogs&fromBlock=${fromBlock}&toBlock=latest&address=${tokenContractAddress}&apikey=${etherscanApiKey}`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        if (data.status === "1" && data.message === "OK") {
          displayEventLogs(data.result);
        } else {
          console.error("Error fetching event logs:", data.message);
        }
      } catch (error) {
        console.error("Error fetching event logs:", error);
      }
    }

    async function getLatestBlockNumber() {
      const apiUrl = `https://api.etherscan.io/api?module=proxy&action=eth_blockNumber&apikey=${etherscanApiKey}`;
      try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        if (data.status === "1") {
          return parseInt(data.result, 16);
        } else {
          throw new Error("Failed to get the latest block number");
        }
      } catch (error) {
        console.error("Error fetching the latest block number:", error);
        throw error;
      }
    }

    function decodeEventData(abi, data) {
      const decoder = new ethers.utils.AbiCoder();
      const decodedData = decoder.decode(abi.inputs, data);
      return decodedData;
    }

    function formatTimestamp(timestamp) {
      const date = new Date(timestamp * 1000);
      return date.toLocaleString();
    }

    function displayEventLogs(eventLogs) {
      const logsDiv = document.getElementById("logs");
      if (eventLogs.length === 0) {
        logsDiv.innerHTML = "No event logs found for the token.";
      } else {
        let html = "<table>";
        html += "<tr><th>Block Number</th><th>Transaction Hash</th><th>Method Name</th><th>Date</th><th>Event Data</th></tr>";
        eventLogs.forEach(eventLog => {
          const methodName = eventLog.topics[0];
          const eventData = decodeEventData(contractABI, eventLog.data);
          const formattedDate = formatTimestamp(eventLog.timeStamp);
          html += "<tr>";
          html += `<td>${eventLog.blockNumber}</td>`;
          html += `<td>${eventLog.transactionHash}</td>`;
          html += `<td>${methodName}</td>`;
          html += `<td>${formattedDate}</td>`;
          html += `<td>${JSON.stringify(eventData)}</td>`;
          html += "</tr>";
        });
        html += "</table>";
        logsDiv.innerHTML = html;
      }
    }

    fetchTokenEventLogs();
  </script>
</body>
</html>


