<!DOCTYPE html>
<html>
<head>
  <title>New Uniswap Tokens</title>
</head>
<body>
  <h1>New Uniswap Tokens</h1>
  <button onclick="fetchNewTokens()">Fetch New Tokens</button>
  <div id="tokenList"></div>

  <script src="https://cdn.ethers.io/lib/ethers-5.4.umd.min.js"></script>
  <script>
    // Replace with your Etherscan API key
const etherscanApiKey = "AFFD2SXUNV3RY968V4442KMBP4928IBMJ7";

// Uniswap Factory contract address on the Ethereum mainnet
const uniswapFactoryAddress = "0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f";

async function fetchNewTokens() {
  const events = await fetchTokenCreationEvents();

  if (events.length === 0) {
    displayNoNewTokens();
  } else {
    const tokens = extractTokenAddresses(events);
    displayTokens(tokens);
  }
}

async function fetchTokenCreationEvents(latestBlock) {
  // The topic0 for PairCreated event is the event signature.
  // It should be a 32-byte hexadecimal value.
  const topic0 = "0xc9c65396";

  const apiUrl = `https://api.etherscan.io/api?module=logs&action=getLogs&fromBlock=${latestBlock}&toBlock=${latestBlock}&address=${uniswapFactoryAddress}&topic0=${topic0}&apikey=${etherscanApiKey}`;

  try {
    const response = await fetch(apiUrl);
    const data = await response.json();

    if (data.status === "1" && data.message === "OK") {
      return data.result;
    } else {
      console.error("Error fetching token creation events:", data.message);
      throw new Error("Failed to fetch token creation events");
    }
  } catch (error) {
    console.error("Error fetching token creation events:", error);
    throw error;
  }
}


function extractTokenAddresses(events) {
  return events.map(event => event.topics[1]); // Assuming the token contract address is in the second topic
}

function displayTokens(tokens) {
  const tokenListDiv = document.getElementById("tokenList");
  tokenListDiv.innerHTML = "<strong>New Tokens:</strong>";
  const ul = document.createElement("ul");

  tokens.forEach(token => {
    const li = document.createElement("li");
    li.textContent = token;
    ul.appendChild(li);
  });

  tokenListDiv.appendChild(ul);
}

function displayNoNewTokens() {
  const tokenListDiv = document.getElementById("tokenList");
  tokenListDiv.innerHTML = "<p>No new tokens created on Uniswap.</p>";
}

  </script>
</body>
</html>
