<!DOCTYPE html>
<html>
<head>
  <title>Fetch Token Info by Transaction Hash</title>
</head>
<body>
  <h1>Fetch Token Info by Transaction Hash</h1>
  <label for="txHash">Enter Transaction Hash:</label>
  <input type="text" id="txHash" />
  <button onclick="fetchTokenInfo()">Fetch Token Info</button>
  <div id="tokenInfo"></div>

  <script>
    // Replace with your Etherscan API key
    const etherscanApiKey = "AFFD2SXUNV3RY968V4442KMBP4928IBMJ7";

    async function fetchTokenInfo() {
      const txHashInput = document.getElementById("txHash").value;
      const apiUrl = `https://api.etherscan.io/api?module=proxy&action=getTransactionByHash&txhash=${txHashInput}&apikey=${etherscanApiKey}`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        if (data.status === "1") {
          const tokenInfo = extractTokenInfo(data.result);
          displayTokenInfo(tokenInfo);
        } else {
          console.error("Error fetching token info:", data.message);
          displayError("Error fetching token info.");
        }
      } catch (error) {
        console.error("Error fetching token info:", error);
        displayError("Error fetching token info.");
      }
    }

    function extractTokenInfo(transactionInfo) {
      // Assuming token transfer event's `input` field contains the token contract address,
      // token transfer method signature, and the recipient's address.
      const input = transactionInfo.input;
      const tokenContractAddress = input.slice(34, 74); // Assuming the contract address is between the 35th and 74th characters of the input
      const toAddress = "0x" + input.slice(74, 114); // Assuming the recipient address is between the 75th and 114th characters of the input

      return {
        tokenContractAddress: tokenContractAddress,
        toAddress: toAddress,
        transactionHash: transactionInfo.hash,
        blockNumber: transactionInfo.blockNumber,
      };
    }

    function displayTokenInfo(tokenInfo) {
      const tokenInfoDiv = document.getElementById("tokenInfo");
      tokenInfoDiv.innerHTML = `
        <p><strong>Token Contract Address:</strong> ${tokenInfo.tokenContractAddress}</p>
        <p><strong>Recipient Address:</strong> ${tokenInfo.toAddress}</p>
        <p><strong>Transaction Hash:</strong> ${tokenInfo.transactionHash}</p>
        <p><strong>Block Number:</strong> ${tokenInfo.blockNumber}</p>
      `;
    }

    function displayError(message) {
      const tokenInfoDiv = document.getElementById("tokenInfo");
      tokenInfoDiv.innerHTML = `<p style="color: red;">${message}</p>`;
    }
  </script>
</body>
</html>
