<!DOCTYPE html>
<html>
<head>
  <title>Token Liquidity Created</title>
</head>
<body>
  <h1>Token Liquidity Created</h1>
  <div id="liquidityInfo"></div>

  <script>
    // Replace with your Etherscan API key and token contract address
    const etherscanApiKey = "AFFD2SXUNV3RY968V4442KMBP4928IBMJ7";
    const tokenContractAddress = "0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f"; // Replace with your token contract address

    async function getBlockNumberByTimestamp(timestamp) {
      const apiUrl = `https://api.etherscan.io/api?module=block&action=getblocknobytime&timestamp=${timestamp}&closest=before&apikey=${etherscanApiKey}`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        if (data.status === "1" && data.message === "OK" && data.result) {
          const blockNumber = parseInt(data.result, 16);
          console.log(blockNumber);
          return blockNumber;
        } else {
          console.error("Error fetching block number by timestamp:", data.message);
          return null;
        }
      } catch (error) {
        console.error("Error fetching block number by timestamp:", error);
        return null;
      }
    }

    async function getTransactionsForBlock(blockNumber) {
      const apiUrl = `https://api.etherscan.io/api?module=proxy&action=eth_getBlockByNumber&tag=${blockNumber}&boolean=true&apikey=${etherscanApiKey}`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        if (data.status === "1" && data.message === "OK" && data.result && data.result.transactions) {
          // Sort transactions in ascending order of age (timeStamp)
          const sortedTransactions = data.result.transactions.sort((a, b) => a.timeStamp - b.timeStamp);
          return sortedTransactions;
        } else {
          console.error("Error fetching transactions for block:", data.message);
          return null;
        }
      } catch (error) {
        console.error("Error fetching transactions for block:", error);
        return null;
      }
    }

    async function getLiquidityCreatedInfo() {
      const oneHourAgoTimestamp = Math.floor(Date.now() / 1000) - 3600; // 1 hour ago
      const blockNumber = await getBlockNumberByTimestamp(oneHourAgoTimestamp);
      if (blockNumber === null) {
        return;
      }

      const transactions = await getTransactionsForBlock(blockNumber);
      if (transactions === null) {
        return;
      }

      // Find the transaction with 1-second age (timeStamp)
      const transaction = transactions.find(t => {
        const ageInSeconds = Math.floor(Date.now() / 1000) - parseInt(t.timeStamp);
        return ageInSeconds === 1;
      });

      if (!transaction) {
        console.error("No transaction found with 1-hour age.");
        return;
      }

      const token0Address = transaction.input.substr(34, 42);
      const token1Address = transaction.input.substr(76, 42);
      const liquidityCreatedInfo = `Transaction Hash: ${transaction.hash}\nToken0 Address: ${token0Address}\nToken1 Address: ${token1Address}`;

      const liquidityInfoDiv = document.getElementById("liquidityInfo");
      liquidityInfoDiv.textContent = liquidityCreatedInfo;
    }

    getLiquidityCreatedInfo();
  </script>
</body>
</html>
