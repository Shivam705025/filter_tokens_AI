<!DOCTYPE html>
<html>
<head>
  <title>Ethereum Contract Events</title>
</head>
<body>
  <h1>Contract Events</h1>
  <div id="events"></div>

  <!-- Add web3.js library -->
  <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
  <script>
document.addEventListener("DOMContentLoaded", async () => {
  // Replace with your contract address and method ID
  const contractAddress = "0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f";
  const methodId = "0xf305d719";

  // Check if Web3 is available
  if (typeof web3 !== "undefined") {
    // Use the existing provider (e.g., MetaMask)
    web3 = new Web3(web3.currentProvider);
  } else {
    // Set up a new provider (e.g., Infura)
    const provider = new Web3.providers.HttpProvider("https://mainnet.infura.io/v3/b80413fa91ea43f2a74700555827bcb4");
    web3 = new Web3(provider);
  }

  // Get contract instance
  const contract = new web3.eth.Contract([], contractAddress);

  // Define the event filter
  const eventFilter = {
    address: contractAddress,
    topics: [web3.utils.sha3(methodId)]
  };

  // Function to fetch events in batches
  async function fetchEvents(fromBlock, toBlock, allEvents) {
    try {
      const events = await contract.getPastEvents("allevents", {
        fromBlock,
        toBlock,
        filter: eventFilter
      });

      if (events.length === 0) {
        // No more events found, display the results
        const eventsDiv = document.getElementById("events");
        if (allEvents.length === 0) {
          eventsDiv.innerHTML = "No events found for the specified contract and method ID.";
        } else {
          let html = "<ul>";
          allEvents.forEach(event => {
            const eventData = JSON.stringify(event.returnValues);
            html += `<li>${eventData}</li>`;
          });
          html += "</ul>";
          eventsDiv.innerHTML = html;
        }
      } else {
        // Concatenate new events with previous batch
        allEvents = allEvents.concat(events);
        // Fetch the next batch of events
        const newFromBlock = events[events.length - 1].blockNumber + 1;
        fetchEvents(newFromBlock, toBlock, allEvents);
      }
    } catch (error) {
      console.error("Error fetching events:", error);
    }
  }

  // Fetch events starting from block 0 to the latest block
  const latestBlock = await web3.eth.getBlockNumber();
  fetchEvents(0, latestBlock, []);
});

  </script>
</body>
</html>
